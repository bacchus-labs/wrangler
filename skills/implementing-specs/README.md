# implementing-specs

Modular specification implementation skill that orchestrates existing wrangler skills.

## Overview

This skill implements specifications end-to-end by coordinating existing skills (writing-plans, implementing-issue) rather than reimplementing their logic. It focuses on workflow orchestration, verification gates, and GitHub PR management.

## Architecture

### Modular Design

```
implementing-specs (orchestrator)
├── Phase 1: INIT     → Uses session_start MCP tool
├── Phase 2: PLAN     → Invokes writing-plans skill
├── Phase 3: REVIEW   → Validates planning coverage
├── Phase 4: EXECUTE  → Dispatches subagents per issue (implementing-issue skill)
├── Phase 5: VERIFY   → LLM-based compliance audit with self-healing
├── Phase 6: PUBLISH  → GitHub PR finalization
└── Phase 7: COMPLETE → Session closure
```

### Benefits

- **No duplication**: Planning logic lives in writing-plans (one place)
- **Direct coordination**: EXECUTE dispatches subagents directly, each following implementing-issue
- **Maintainability**: Changes to planning/execution update all consumers
- **Testability**: Each skill can be tested independently
- **Composability**: Skills can be invoked standalone or orchestrated

## Dependencies

### Required Skills

- **writing-plans**: Creates MCP issues from specification
- **implementing-issue**: Implements a single issue with TDD and code review
- **practicing-tdd**: TDD workflow enforced during implementation
- **requesting-code-review**: Code review framework used during implementation

### Required Tools

- **session_start**: MCP tool for worktree initialization
- **session_phase**: MCP tool for phase tracking
- **session_checkpoint**: MCP tool for recovery
- **session_complete**: MCP tool for finalization
- **issues_create**: MCP tool for issue creation (via writing-plans)
- **issues_list**: MCP tool for issue querying
- **issues_update**: MCP tool for marking issues in progress
- **issues_mark_complete**: MCP tool for closing completed issues

## Workflow Phases

### Phase 1: INIT

- Calls `session_start` MCP tool to create worktree
- Verifies worktree location and branch
- Establishes session context

### Phase 2: PLAN

- Dispatches planning subagent with specification
- Subagent invokes `writing-plans` skill
- writing-plans creates MCP issues (source of truth)
- Optional plan file created for architecture context
- Creates GitHub PR with overview (not full plan)

**Key insight**: Individual issues are generated by writing-plans calling `issues_create` for each task with complete implementation details (files, code, tests, commands).

### Phase 3: REVIEW

- Validates acceptance criteria coverage against created tasks
- Auto-creates supplemental tasks if coverage < 95%
- Advisory gate: user decides whether to proceed with gaps

### Phase 4: EXECUTE

- Iterates over issue IDs, dispatching a subagent for each
- Each subagent follows the `implementing-issue` skill
- Each subagent follows TDD (RED-GREEN-REFACTOR)
- Automatic code review after each issue
- Auto-fix for Critical/Important issues (2 attempts)
- Checkpoints saved after each issue for recovery
- Blockers escalated to user immediately

**Key insight**: This skill coordinates the execution loop directly. Each subagent receives the worktree context and implements a single issue end-to-end.

### Phase 5: VERIFY

- LLM reads spec and extracts acceptance criteria
- Verifies each criterion has evidence (tests, code, commits)
- Runs fresh test suite
- Checks git status (must be clean)
- Calculates compliance percentage
- Self-healing: auto-fixes test/doc/edge-case gaps (up to 3 iterations)
- **BLOCKS if compliance < 90% after self-healing**

**Key insight**: LLM-based extraction handles varied spec formats gracefully (not brittle regex parsing).

### Phase 6: PUBLISH

- Updates PR description with final summary
- Lists all tasks with commit hashes
- Shows test results and compliance
- Marks PR ready for review
- Adds reviewers if configured

### Phase 7: COMPLETE

- Calls `session_complete` MCP tool
- Records PR URL, session ID, metrics
- Presents completion summary
- Provides audit trail location

## Quality Gates

| Phase | Gate | Required |
|-------|------|----------|
| INIT | Worktree created | Yes |
| PLAN | Issues created | Yes |
| REVIEW | Coverage >= 95% (or user approval) | Advisory |
| EXECUTE | All tasks complete | Yes |
| VERIFY | >= 95% compliance | Yes |
| VERIFY | All tests passing | Yes |
| VERIFY | Git clean | Yes |
| PUBLISH | PR ready | Yes |

**VERIFY phase is mandatory and cannot be skipped.**

## Usage

### Via Slash Command

```
/wrangler:implementing-specs SPEC-000042
```

### Manual Invocation

```markdown
I'm using the implementing-specs skill to implement SPEC-000042.md
```

See `SKILL.md` for detailed workflow documentation.

## Examples

See `examples/` directory:
- `simple-feature.md` - Backend feature (no E2E)
- `complex-feature.md` - User-facing feature (with E2E)
- `recovery.md` - Session recovery after interruption

## Scripts

### generate-pr-description.sh

Generates PR description from template and session data.

**Usage:**
```bash
./scripts/generate-pr-description.sh <phase> <session-data>
```

**Phases:**
- planning: Initial PR creation
- execution: Progress updates
- verification: Quality gate results
- complete: Final summary

### update-pr-description.sh

Updates GitHub PR description via gh CLI with sanitization.

**Usage:**
```bash
./scripts/update-pr-description.sh <prNumber> <newDescription>
```

**Features:**
- Sanitizes sensitive data (tokens, credentials)
- Validates PR exists before update
- Error handling for gh CLI failures

### Removed Scripts

- `analyze-spec.sh` - Removed (replaced with LLM-based extraction)
- `audit-spec-compliance.sh` - Removed (integrated into VERIFY phase)
- `orchestrator.sh` - Removed (logic now in SKILL.md)

**Why removed**: Brittle regex parsing that breaks with spec format variations. LLM-based extraction is more robust and intelligent.

## Testing

No tests currently (orchestration skill, not implementation).

Future testing considerations:
- Mock skill invocations
- Test phase transitions
- Test quality gate logic
- Test recovery scenarios

## Integration with Wrangler

This skill is part of the wrangler skills library and follows wrangler patterns:

- Uses MCP tools for session management
- Invokes existing skills (no duplication)
- Follows TDD enforcement via implementing-issue skill
- Uses GitHub PR as primary audit trail
- Supports worktree isolation
- Provides recovery capability via checkpoints

## File Structure

```
implementing-specs/
├── SKILL.md                    # Detailed workflow documentation
├── README.md                   # This file (architecture overview)
├── references/
│   └── detailed-guide.md       # Complete workflow details and troubleshooting
├── examples/                   # Usage examples
│   ├── simple-feature.md       # Backend feature example
│   ├── complex-feature.md      # UI feature with E2E
│   └── recovery.md             # Session recovery example
├── scripts/                    # Helper scripts
│   ├── generate-pr-description.sh
│   ├── update-pr-description.sh
│   └── utils/                  # Shared utilities
└── templates/                  # PR description templates
    ├── planning.md
    ├── execution.md
    ├── verification.md
    └── complete.md
```

## Contributing

When modifying this skill:

1. **Planning changes**: Update `writing-plans` skill (not here)
2. **Single-issue implementation changes**: Update `implementing-issue` skill (not here)
3. **Orchestration changes**: Update `SKILL.md` (here)
4. **Verification changes**: Update VERIFY phase logic (here)
5. **PR management changes**: Update scripts or templates (here)

**Keep orchestration logic separate from implementation logic.**

## Related Documentation

- [SKILL.md](SKILL.md) - Detailed workflow documentation
- [references/detailed-guide.md](references/detailed-guide.md) - Complete workflow details and troubleshooting
- [skills/writing-plans/SKILL.md](../writing-plans/SKILL.md) - Planning skill
- [skills/implementing-issue/SKILL.md](../implementing-issue/SKILL.md) - Single issue implementation skill
- [docs/MCP-USAGE.md](../../docs/MCP-USAGE.md) - MCP tools reference

## Version History

- **v3.0.0** (2026-02-05): Direct subagent coordination
  - EXECUTE phase dispatches subagents directly per issue
  - Removed delegation to implementing-issue as coordinator
  - Each subagent follows implementing-issue skill independently
  - Added REVIEW phase for planning coverage validation

- **v2.0.0** (2025-02-02): Modular architecture refactor
  - Removed brittle spec parsing scripts
  - Changed to skill orchestration pattern
  - Added LLM-based verification
  - Added mandatory VERIFY phase
  - Improved recovery capability

## License

MIT (part of wrangler project)
